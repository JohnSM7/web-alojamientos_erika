---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import { Icon } from 'astro-icon/components';

// 1. GenerateStaticPaths indica a Astro qué páginas debe construir
export async function getStaticPaths() {
  const alojamientos = await getCollection('alojamientos');
  return alojamientos.map(entry => ({
    params: { slug: entry.slug }, title: entry.data.title, props: { entry },
  }));
}

// 2. Obtenemos los datos de la página actual
const { entry } = Astro.props;
const { title, location, mainImage, gallery, amenities, bookingLinks } = entry.data;
// Renderizamos el contenido Markdown (la descripción larga)
const { Content } = await entry.render();
---

<BaseLayout title={title}>
  
    <div class="h-[50vh] md:h-[60vh] relative overflow-hidden bg-gray-100">
        <img src={mainImage} alt={title} class="w-full h-full object-cover" />
    </div>

    <div class="container mx-auto px-6 py-16">
        <div class="flex flex-col lg:flex-row gap-16">
            
            <div class="lg:w-2/3">
                <div class="flex items-center text-gray-500 mb-4 space-x-2 font-light tracking-wide uppercase text-sm">
                     <Icon name="mdi:map-marker-outline" class="h-5 w-5" />
                    <span>{location}</span>
                </div>
                <h1 class="text-4xl md:text-5xl font-light text-gray-900 mb-8">{title}</h1>
                
                <div class="prose prose-lg prose-gray max-w-none font-light prose-headings:font-normal prose-headings:text-gray-900 prose-a:text-gray-800">
                    <Content />
                </div>

                <div class="mt-16 pt-12 border-t border-gray-100">
                    <h3 class="text-2xl font-light mb-8">Servicios y Comodidades</h3>
                    <ul class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {amenities.map(amenity => (
                            <li class="flex items-center text-gray-700 font-light">
                                <svg class="h-5 w-5 text-gray-400 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M5 13l4 4L19 7" />
                                </svg>
                                {amenity}
                            </li>
                        ))}
                    </ul>
                </div>

                 <div class="mt-16 pt-12 border-t border-gray-100">
                    <h3 class="text-2xl font-light mb-8">Galería</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        {gallery.map(imageSrc => (
                            <div class="aspect-w-16 aspect-h-9 bg-gray-100 rounded-lg overflow-hidden">
                                <img src={imageSrc} alt={`Foto de ${title}`} class="w-full h-full object-cover hover:scale-105 transition-transform duration-500" />
                            </div>
                        ))}
                    </div>
                </div>
            </div>

            <div class="lg:w-1/3 lg:sticky lg:top-24 h-fit">
                <div class="bg-gray-50 p-8 rounded-2xl border border-gray-100 shadow-sm">
                    <h3 class="text-xl font-medium mb-6 text-center text-gray-900">¿Listo para reservar?</h3>
                    <p class="text-gray-600 font-light text-center mb-8 text-sm">
                        Gestionamos nuestras reservas a través de plataformas seguras para tu tranquilidad.
                    </p>
                    
                    <div class="flex flex-col space-y-4">
                        {bookingLinks.airbnb && (
                            <a href={bookingLinks.airbnb} target="_blank" rel="noopener noreferrer" class="flex items-center justify-center w-full bg-[#FF5A5F] hover:bg-[#e04e53] text-white font-medium py-3 px-4 rounded transition text-center">
                                <svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M22.057 19.613c-.466-1.049-1.505-2.105-2.546-2.911-1.267-1.016-2.662-1.829-3.965-2.57-.727-.425-1.509-.842-2.295-1.259-.814-.431-1.662-.86-2.549-1.288-.41-.198-.838-.379-1.268-.556-.421-.173-.84-.317-1.247-.441-.384-.118-.751-.197-1.075-.242-.294-.042-.55-.054-.751-.043-.187.01-.332.042-.44.102-.095.052-.15.119-.2.239-.05.119-.102.285-.156.521-.109.467-.242 1.172-.38 2.086-.133.905-.265 1.994-.389 3.209-.097.946-.196 1.972-.287 3.054-.024.28-.047.554-.069.824-.023.27-.045.528-.064.765-.019.237-.035.451-.048.637-.01.186-.016.345-.016.47 0 .098 0 .226.002.391.002.165.006.371.012.613.006.242.016.525.032.844.016.32.038.676.066 1.059.028.383.064.789.109 1.205.046.416.102.837.167 1.257.065.42.14.833.223 1.23.083.397.177.778.283 1.139.106.361.223.695.353.994.13.299.273.559.431.781.158.222.332.404.526.545.194.141.408.24.643.297.235.057.492.072.773.043.281-.029.585-.103.914-.225s.682-.288 1.06-.5c.378-.212.78-.467 1.208-.767.429-.3.882-.644 1.363-1.035 1.232-.998 2.619-2.354 4.163-4.069.249-.276.487-.543.712-.799.225-.256.438-.501.639-.734.201-.233.39-.454.566-.662.176-.208.339-.403.488-.582.149-.18.285-.346.407-.496s.23-.286.322-.406c.092-.12.171-.224.237-.311.066-.087.118-.156.156-.206.038-.05.061-.08.07-.089l.011-.011s-.011.012-.033.036c-.022.024-.055.059-.099.104-.044.046-.101.101-.171.169s-.152.146-.249.234c-.097.089-.208.187-.333.292s-.266.218-.417.335c-.151.117-.317.237-.498.357-.181.121-.377.242-.588.36-.211.118-.438.233-.681.343-.243.11-.502.213-.777.306-.275.094-.565.178-.871.249-.306.071-.628.128-.965.166-.338.038-.691.059-1.059.059-.184 0-.368-.006-.553-.016-.092-.005-.184-.011-.276-.017-.092-.006-.184-.011-.276-.018-.184-.012-.368-.025-.551-.04-.367-.031-.732-.068-1.094-.113-.362-.045-.722-.097-1.079-.154-.356-.057-.708-.12-1.057-.188-.348-.068-.692-.143-1.031-.221-.34-.078-.674-.165-1.003-.254-.329-.089-.654-.188-.973-.289-.319-.101-.633-.209-.939-.321-.307-.112-.607-.23-.9-.351-.293-.121-.58-.249-.861-.379s-.555-.27-.821-.411c-.267-.141-.528-.288-.783-.437-.255-.148-.503-.3-.744-.453s-.476-.313-.704-.473c-.228-.159-.448-.323-.659-.486-.211-.163-.413-.331-.606-.497-.193-.167-.377-.336-.551-.504s-.338-.339-.493-.507-.297-.339-.431-.507c-.134-.167-.254-.332-.361-.496-.107-.163-.199-.325-.277-.483-.078-.158-.14-.315-.186-.466-.046-.152-.078-.3-.097-.443-.019-.144-.024-.283-.016-.417.008-.133.031-.262.067-.386.036-.124.086-.243.149-.358.063-.114.139-.225.229-.331.09-.106.192-.208.306-.306s.241-.192.381-.281c.14-.089.291-.173.453-.253s.336-.156.523-.229c.188-.072.387-.141.598-.205s.434-.124.679-.178c.245-.055.502-.104.771-.147.269-.042.549-.08.839-.111.29-.032.591-.058.901-.077.31-.02.631-.032.961-.038.165-.003.331-.006.498-.006h.251c.083 0 .166 0 .249.001s.166.002.249.003l.497.008c.331.006.661.014.989.024.328.01.655.023.98.038.325.015.648.033.97.054.321.021.641.043.959.068.318.025.635.053.95.082.315.03.629.063.941.097s.623.069.931.105.616.076.92.115c.305.04.607.081.905.124.298.043.593.089.883.135s.577.096.86.146c.284.051.563.104.837.157s.543.109.808.166c.265.056.525.114.78.174.255.059.504.12.746.183.242.063.478.126.707.192.229.065.451.132.666.201.215.069.423.139.623.211.201.072.394.145.579.22.185.074.363.15.533.228.17.078.332.157.487.239.155.081.302.163.441.248.139.085.27.171.393.258.123.088.238.178.345.27s.204.185.295.28c.091.096.173.193.247.291s.138.202.191.304c.053.103.095.208.127.314.032.107.052.217.062.329.01.112.008.227-.004.343s-.036.234-.074.351c-.038.117-.088.234-.15.351s-.134.233-.218.348c-.084.115-.18.228-.286.339-.106.111-.223.219-.349.324s-.264.206-.41.303c-.146.097-.3.188-.461.275s-.331.167-.507.243c-.176.076-.357.146-.542.21-.185.064-.374.123-.566.176-.193.053-.389.101-.588.143s-.401.079-.604.109c-.203.031-.407.056-.612.075s-.412.032-.618.041c-.206.01-.412.014-.617.012s-.411-.008-.615-.022c-.205-.013-.408-.032-.61-.056-.202-.023-.403-.053-.602-.088s-.397-.075-.591-.117c-.194-.042-.387-.09-.576-.142-.189-.052-.376-.11-.559-.173-.183-.063-.363-.131-.538-.205-.175-.074-.346-.153-.513-.237-.167-.084-.329-.173-.486-.267s-.309-.194-.456-.297c-.147-.104-.288-.212-.423-.325s-.264-.23-.384-.351c-.121-.121-.234-.246-.339-.375s-.202-.261-.289-.397c-.088-.136-.167-.273-.237-.412s-.129-.281-.179-.425c-.05-.144-.088-.289-.115-.436-.027-.146-.041-.293-.043-.439-.002-.146.009-.291.032-.435s.058-.285.105-.423c.047-.139.106-.274.178-.406.072-.132.156-.259.252-.382s.204-.238.326-.348c.122-.109.255-.212.401-.309s.304-.187.473-.27c.169-.083.349-.158.54-.226.191-.068.393-.128.604-.179.211-.051.433-.094.663-.127.23-.033.469-.057.717-.071s.504-.019.768-.012c.264.007.535.024.814.052s.563.066.854.113c.29.047.585.105.885.174s.605.15.913.241c.308.091.621.193.937.307.316.114.636.24.958.377.322.137.647.286.974.446.327.161.656.332.986.515s.661.376.992.58c.331.204.662.417.993.639s.661.453.991.694c.329.24.656.488.981.744.325.256.648.519.968.79.319.271.635.55.947.836s.619.58.922.884c.303.303.601.614.894.933.293.319.58.645.861.979s.556.675.826 1.022c.269.347.531.701.785 1.061.254.36.499.727.736 1.101s.465.753.684 1.14c.219.387.428.781.628 1.181.2.4.389.806.569 1.218s.349.828.508 1.25c.16.421.308.847.447 1.276s.265.865.378 1.302c.114.437.215.877.304 1.32.088.444.164.891.228 1.342.063.45.113.903.151 1.358.038.455.063.913.075 1.373.013.46.013.922.002 1.386z" /></svg>
                                Reservar en Airbnb
                            </a>
                        )}
                        {bookingLinks.bookingCom && (
                            <a href={bookingLinks.bookingCom} target="_blank" rel="noopener noreferrer" class="flex items-center justify-center w-full bg-[#003580] hover:bg-[#002c6a] text-white font-medium py-3 px-4 rounded transition text-center">
                                <span class="font-bold mr-2">B.</span>
                                Reservar en Booking.com
                            </a>
                        )}
                    </div>
                </div>
            </div>
        </div>
    </div>
</BaseLayout>